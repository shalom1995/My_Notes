# 草稿

## 闪电贷

### 登陆远程服务器

```sh
ssh -i /Users/shalomhu/Desktop/pem/CON_MONITOR.pem ubuntu@3.35.177.187
ssh -i /Users/shalomhu/Desktop/pem/forbscgeth.cer ubuntu@35.86.61.129
go build -o api cmd/api/main.go
go build -o collector cmd/collector/main.g
```

FQ4S5QAHV2DYN3RX84GUVQNST4G18W8K55  Etherscan

### 部署

1. 将平台合约库丰富
    1. `Insert flash_loan_src`
    2. 不需要再新增 flag 表
2. 将数据库表更新修改
    1. 新增那两个表
    2. 将tx表修改
3. 编译重启服务

the graph

1. 能否实现功能，未知

购买 rpc 节点

1. 需要计算请求次数
2. 是否也有log数量限制？
3. 速率和每日请求量
4. 哪个节点比较靠谱

购买 etherscan api 服务

1. 最终还是需要节点服务

BSC公共节点列表：

recomment

- <https://bsc-dataseed.binance.org/>
- <https://bsc-dataseed1.defibit.io/>
- <https://bsc-dataseed1.ninicoin.io/>

backup

- <https://bsc-dataseed2.defibit.io/>
- <https://bsc-dataseed3.defibit.io/>
- <https://bsc-dataseed4.defibit.io/>
- <https://bsc-dataseed2.ninicoin.io/>
- <https://bsc-dataseed3.ninicoin.io/>
- <https://bsc-dataseed4.ninicoin.io/>
- <https://bsc-dataseed1.binance.org/>
- <https://bsc-dataseed2.binance.org/>
- <https://bsc-dataseed3.binance.org/>
- <https://bsc-dataseed4.binance.org/>

The rate limit of BSC endpoint on Testnet and Mainnet is 10K/5min.

池子，随机分配到其他节点，若节点出问题，就搁置到其他节点池中

1. 将第一版上线，去掉历史数据获取进程，最新数据保持正常运行  ok
2. 增加监测的池子    ok
3. 维护一个币价表，更改门槛策略    ok
4. 将任务改成并行获取，增加备用节点功能  ok
5. 维护一个token数据表，需要价格.   Ok
6. 将gorm换成xsql ok(看情况再更换)
7. 通过指定的区间，来判断准确度
8. 将unusual的交易筛选规则精细化（看情况做）

PeckShield:

1. 0x16c87d9c4eb3bc6c4e5fbba789f72e8bbfc81b3403089294a81f31b91088fc2f <https://twitter.com/peckshield/status/1407529373402419200>
2. 0x153eeae811a9acedad4dc76492316d5503a02ad8a324563a50b7118b4f574469 <https://twitter.com/peckshield/status/1407479655142100994>
3. 0xeaaa8f4d33b1035a790f0d7c4eb6e38db7d6d3b580e0bbc9ba39a9d6b80dd250 <https://twitter.com/peckshield/status/1407477776198737922> [ok]
4. 0x0220704a99ddfb982d26e65cc337f26b77dc057930b7aa1d848cc48ec77984a8 <https://twitter.com/peckshield/status/1406839879305101313> [ok]
5. 0x5db64a4b50ba734a57228816807901a893c44c1dc49b6f0f5ee3534c5aecbe03 <https://twitter.com/peckshield/status/1400929644807954433> [ok]
6. 0x50b0c05dd326022cae774623e5db17d8edbc41b4f064a3bcae105f69492ceadc <https://twitter.com/peckshield/status/1398757685714108418> [ok]
7. 0xac8a739c1f668b13d065d56a03c37a686e0aa1c9339e79fcbc5a2d0a6311e333 <https://twitter.com/peckshield/status/1398025307223851009?s=20> [ok]
8. 0xfbe65ad3eed6b28d59bf6043debf1166d3420d214020ef54f12d2e0583a66f13 <https://twitter.com/peckshield/status/1396950958664466434?s=20> [ok]

## Decentraland

### World

#### Introduction

1. Purchase parcels by MANA which is Decentraland's cryptocurrency.
2. Parcels can be created by community, and they can organize parcels into Districts which are shared spaces with common interests.
3. Land is divided into parcels.
4. Parcels are maintained in a ETH smart contract. They are non-fungible digital assets.

#### FAQ

问题：

1. 有一部分内容不是链上资产，有一部分是，具体哪些是链上资产？哪些不是链上的？

    names, collectibles, LANDs？

    1. **是链上的：**
        - 每日奖励
        - 不定期的世界事件
        - 不能在不同设备登陆，登陆是根据钱包签名做的
    2. **不是链上的**：
        - 聊天
        - 在虚拟世界到处行走
        - 装扮？有一部分是链上的，有一部分不是

## Curve

1. 为什么curve能够让其他人很难fork？

## 甘霖

1. 翻墙，看看一些国外画家的视频

2. 找到一些艺术分享论坛，高质量的那种，并且有很多大咖

    <https://zhuanlan.zhihu.com/p/24456720>

3. 每周出3-4幅作品，想画啥就画啥，发布到论坛上

4. 去那些高校旅游，看看那里的人文、环境、操场、食堂、展览；如果当地有艺术展览的话，顺便参加一下

## Study

1. xsql <https://github.com/jmoiron/sqlx>
2. nginx
3. grpc

## Alchemytoys

NFT Address：0x14a62860de2fdec247d48780ed110dbb794545d8

Game Address：0xeC5648918E81f98E062ACc0a8cE8d86a0c9C211d

Bakery Address：0x735c9f9e03011a04c537fe7b4e839317ef64cf03

GAT Address:  0xf315cfc8550f6fca969d397ca8b807c5033fa122

WBNB address：0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c

bake factory：0x01bF7C66c6BD861915CdaaE475042d3c4BaE16A7

cake factory：0xcA143Ce32Fe78f1f7019d7d551a6402fC5350c73

WBNB-GAT-bake: 0xAD19E7D581b6f252AFA5aAE3c6C8dC3680A475c3

WBNB-GAT-cake: 0x05F802fa3ebc5E14254E55668Bf8a0d8037bE1d3

Transfer Address: 0xB4fd24402fA57ccF83538D28033da9E62D4a9Ac7

Shalom01: 0x382ba03866e9e464aDFD8132c268A53cd8aBCF86

11-2

274920 243991 293961 129530 = 942402

3.428 3.862 3.206 7.276 = 17.772  0.409

## Hord

Hord: 0x43A96962254855F16b925556f9e97BE436A43448

Staking contract: 0x76Fec984cD5Cf860916a182899B878ff24bDEdd4

## Nodejs

### 异步编程

1. 通过中间函数减少回调嵌套

    ```js
    var http = require('http');
    
    var fs = require('fs');
    
    var server = http.createServer(function (req, res)
      getTitles(res);
    }).listen(8000, "127.0.0.1");
    
    
    function getTitles(res) {
      fs.readFile('./titles.json', function (err, data) {
        if (err) return hadError(err, res)　　//在这里不再创建一个else分支，而是直接return，因为如果出错的话，也没必要继续执行这个函数了
    
        getTemplate(JSON.parse(data.toString()), res)
      })
    }
    
    function getTemplate(titles, res) {
      fs.readFile('./template.html', function (err, data) {
        if (err) return hadError(err, res)
        formatHtml(titles, data.toString(), res)
      })
    }
    
    function formatHtml(titles, tmpl, res) {
      var html = tmpl.replace('%', titles.join('</li><li>'));
      res.writeHead(200, {'Content-Type': 'text/html'});
      res.end(html);
    }
    
    function hadError(err, res) {
      console.error(err)
      res.end('Server Error')
    }
    ```

2. 使用事件发射器来组织回调

    ```js
    var events = require('events');
    
    var net = require('net');
    
    var channel = new events.EventEmitter();
    
    channel.clients = {};
    
    channel.subscriptions = {};
    
    channel.on('join', function(id, client) {
      this.clients[id] = client;  //添加join事件的监听器，保存用户的client对象，以便程序可以将数据发送给用户；  
    
      this.subscriptions[id] = function(senderId, message) {
        if (id != senderId) {  //忽略发出这一广播数据的用户
          this.clients[id].write(message);
        } 
      }
    
      this.on('broadcast', this.subscriptions[id]);  //添加一个专门针对当前用户的broadcast事件监听器
    });
    
    var server = net.createServer(function (client) {
      var id = client.remoteAddress + ':' + client.remotePort;
      client.on('connect', function() {
        channel.emit('join', id, client);   //当有用户连到服务器上来时发出一个`join`事件，指明用户ID和client对象
      });
    
      client.on('data', function(data) {
        data = data.toString();
        channel.emit('broadcast', id, data);  //当有用户发送数据时，发出一个频道`broadcast`事件，指明用户ID和消息
      });
    });
    
    server.listen(8888);
    ```

## 套利

Cake：0x0e09fabb73bd3ade0a17ecc321fd13a19e81ce82

WBNB：0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c

BUSD：0xe9e7cea3dedca5984780bafc599bd69add087d56

Router: 0x10ED43C718714eb63d5aA57B78B54704E256024E

### LP

Cake-WBNB: 0x0eD7e52944161450477ee417DE9Cd3a859b14fD0

Cake-BUSD: 0x804678fa97d91B974ec2af3c843270886528a9E6

WBNB-BUSD: 0x58F876857a02D6762E0101bb5C46A8c1ED44Dc16

```sh
cake_wbnb_reserve_cake,cake_wbnb_reserve_wbnb,busd_wbnb_reserve_wbnb,busd_wbnb_reserve_busd,cake_busd_reserve_busd,cake_busd_reserve_cake,timestamp
```

## IPFS

<https://gateway.ipfs.io/ipfs/QmXgSuLPGuxxRuAana7JdoWmaS25oAcXv3x2pYMN9kVfg3/1651>

## DAO

我的随想：

- 通过不同锁仓时间来平衡风险，决策执行方的锁仓时间远高于投票失败方，这样投票失败方可以有充足的时间规避自己的风险，可以是分叉，也可以是卖掉治理代币。

## 合约技术信息

[时间锁](https://blog.openzeppelin.com/bypassing-smart-contract-timelocks/)

## AladdinDAO

### 角色

#### Talent Hunters         人才猎手

- 负责为DAO邀请Boule成员，任命需要通过DAO治理
- 每位Hunter最多可以邀请5位Boule
- 最原始的Hunter成员为DAO最早期的支持者

#### Boule Members          Boule成员

- 是最顶级的DEFI专家，负责选择最好的DEFI项目，使得DAO在这些项目中获得挖矿收益
- 80%由第人才猎手推出，20%由社区直接推荐
- Boule可能晋升为人才猎手，也可能被淘汰

#### Boule Plus Members     Boule预备成员

通过以下条件可以成为Boule预备成员

1. 通过DAO的任何一项测验
2. 提供可验证的twitter账号
3. 抵押一定数量的治理代币 ALV

#### Strategy Developers    策略开发者

代码实现者，可以获得相应的奖励

#### DAO成员

DAO普通成员

## Flashbots

```sh
# Identity account
fb01 simulate 0xB54E16EB94bADe99E691be0C5E941aA700497ACD f203e301501837897a65bd5515dc9b9cde88f3861dc71ee11ba0e09fe25ba7de

fb02 simulate 0x4dA1e552D98D827c82a3547feA2e0372D241977d 90a795cc42921becf12052b28630b6ae712875d0815013b545e9013f1d4073e9

fb03 0x842691b5e7FE06b107035be62C3d09c3abC283E1 75b6b70494751283c8e0c8ad54f21a37acf18ee9d6d605e504c5dc8500286e8a
```

## GameDao

rinkeby 测试合约：

maket: <https://rinkeby.etherscan.io/address/0x051fe144fda181b5593e4a36327f6d258c528116>

testNFT01: <https://rinkeby.etherscan.io/address/0x580A99cEdaBC4032E9320dac5C326982199aC8c7>

testNFT02: <https://rinkeby.etherscan.io/address/0xCFD06377fae87E443D553395906AF8fe34700feA>

testNFT03: <https://rinkeby.etherscan.io/address/0x2B777eC8167be84711339A3512B3A22b826d63e0>

testERC20: <https://rinkeby.etherscan.io/address/0x20c39d5d67c3f26fbbe054d98c1f2fc98bdafe25>

零地址：0x0000000000000000000000000000000000000000

客户端
SDK
SDK服务器
游戏服务器

工作安排：

- SDK
  Android   IOS   Server

  1. 流程图
  2. 架构图
  3. 接口规范
  4. 风控实现
  5. NFT处理方案

### 旧的SDK说明

游戏服务器向SDK认证user_token的有效性

向SDK提供的接口发送POST请求

app_key是SDK服务器给游戏服务器的密钥，用来验证是否是游戏服务器发来的请求；

参数中还有sign，使用md5来计算出sign：md5(app_id=...&mem_id=...&user_token=...&app_key=...)

最后SDK客户端用：app_id mem_id user_token sign 来验证 user_token 是否有效。

### 怪物工程师

装备

- 技能变更（融合）
- 基础属性值更改（强化）
- 对应图像更改（融合两个装备时，更换肤色时）
- 星级（强化）
- 增加技能（基因重组）

如果要实现整体当作一个nft上链，然后再分解出不同装备、躯干，则需要游戏支持选择多个角色。

属性

- 数值增长
- 属性增加
- 属性解绑
- 属性更换（基础属性和技能、子技能更换）
- 属性并不可交易

交易情况

- 解锁
- 交易
- 属性改变

解锁后才能够交易和改变属性
解锁应该怎么写？

## NFT && FT 整体设计

### FT 测试网合约

Factory: 0x2a2b01E32FcC809481460628B7bA967c62ca8Fdd

Proxy: 0x8808f1c84811AAbc4d25f7E270F8e5C84F766bc1

Logic: 0x4b48a7dBFcb3B94bAFc02E99bCec353180249f03

### 签名合约案例

恐龙： 0xF7143Ba42d40EAeB49b88DaC0067e54Af042E963
高达： 0x9A534628B4062E123cE7Ee2222ec20B86e16Ca8F

测试合约： 0x8141F2fC46e9DC6A3Df9eD2BE138D1674ca5a41f

### 链接记录

签名协议：<https://eips.ethereum.org/EIPS/eip-191>

## bsc节点搭建

```bash
# 后台解压
nohup tar zxvf geth.tar.gz &
# 查看解压进度
tail -f /home/ubuntu/nohup.out
# 初始化
./build/bin/geth --datadir ../bscNode/ init genesis.json
# 节点启动命令
/1.5T/bsc/build/bin/geth --config /1.5T/bsc/config.toml --http --ws --graphql --syncmode fast --datadir /1.5T/bscNode --diffsync --snapshot=false  --cache 8000 --rpc.allow-unprotected-txs --txlookuplimit 2350000
# 进入控制台
./build/bin/geth attach http://localhost:8545
```

Please visit https://api.binance.org/v1/discovery/peers to get dynamic peer info. You can append the peer info to the StaticNodes in the config.toml 

同步模式 fast：  

当前Geth的默认同步模式称为快速同步。快速同步不是从起源块开始，然后重新处理所有发生过的事务(这可能需要几周的时间)；而是下载块，并且只验证相关的工作证明。下载所有的块是一个简单和快速的过程，将相对较快地重新组装整个链。  

许多人错误地认为，因为他们拥有这些块，所以他们是同步的。不幸的是，情况并非如此，因为没有执行任何事务，所以我们没有任何可用的帐户状态(即。余额、nonces、智能合约代码和数据)。这些需要分别下载，并与最新的块交叉检查。这个阶段叫做 the state trie download，它实际上是与块下载同时运行的，比下载数据块要花更长的时间。

You should see in your Geth console Imported state entries logs scrolling and you must wait for the sync to complete 




- 写入属性数据 签名
- 盲盒NFT   映射多个   NFT合约
- 盲盒
  - 或者全部打乱；盲盒开盲盒，先开品质，再开具体装备

### NFT 需求整理

装备合约
- 游戏内部增发后，上链
- 套装合约分解时 mint

套装合约
- 公开mint
- 分解

TODO：
- presale
- 总量上限
- SDK将蓝白装备过滤
- 装备合约的公售？
 
Rinkeby部署好的合约：
```
gameLootTreasure deployed to: 0x0405eeD0B202b08E04e715A78E4846E5Ccd5C7e2
Body deployed to: 0xb6fa88Be3FA90549fa98A7D3bA174D74DE152A41
Head deployed to: 0xE781B6628088460294FF3e247969086F639C0B44
Hand deployed to: 0x1e47A3a0b6D38Fc3f815DAF82664B595CD7C3fAF
Leg deployed to: 0x4eAa7d8e7Ad0e845E50fD37E133A88381ce1e1ac
Accessory deployed to: 0xD500901d4B8034288f554bfe84D08048B651855A
gameLootSuit deployed to: 0xa8F4970caE2A0332cff5579D39E9eDfd4bFa0587
```

TokenID映射表：
- 游戏和合约各自拥有自己的ID算法
- 一旦有NFT增发上下链，就在映射关系中记录
- 不可以有任何错误发生

#### 合约记录

将bytes32以16进制打印出来：
```solidity
function bytes32ToString(bytes32 _bytes32) public pure returns (string memory) {
    uint8 i = 0;
    bytes memory bytesArray = new bytes(64);
    for (i = 0; i < bytesArray.length; i++) {

        uint8 _f = uint8(_bytes32[i / 2] & 0x0f);
        uint8 _l = uint8(_bytes32[i / 2] >> 4);

        bytesArray[i] = toByte(_f);
        i = i + 1;
        bytesArray[i] = toByte(_l);
    }
    return string(bytesArray);
}

function toByte(uint8 _uint8) public pure returns (bytes1) {
    if (_uint8 < 10) {
        return bytes1(_uint8 + 48);
    } else {
        return bytes1(_uint8 + 87);
    }
}
```

测试合约：

gameLootTreasure deployed to: 0xc2424e4159918022Da7a1950C6Fe3A59f46469cc
Body deployed to: 0xF9Ef6F54eF2505909c7B6A5898526C24E317E9dB
Head deployed to: 0x852098ecCBAa3C95991f7ae3245D2495be066Fd9
Hand deployed to: 0x0C3656f3dA5e91bD00Bead4A57014C6685FD86DA
Leg deployed to: 0x189cff0CBAF2E2e9512EAf38b6C6596ddde56a65
Accessory deployed to: 0x358213dEb1461f915592eCc8fB2d40997EEDc972
gameLootSuit deployed to: 0x9e28EE9CD14e3800aC76046bE30d428F7ECf5355


#### SVG笔记

<https://www.zhangxinxu.com/wordpress/2014/08/svg-viewport-viewbox-preserveaspectratio/>


/*
TokenURI
    - Loot 给出NFT拥有的字段名(这里是字符串)，图形由不同的前端可以实现不同的视觉效果
    - 传统NFT 一个URI带出所有属性和图片URL，然后直接展示
    - 我们的NFT 既有属性，也有属性值，而且都在链上，与Loot不同的是：属性的形象已经被游戏设计好。
*/

    //  TODO param doc
