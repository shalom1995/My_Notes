# 草稿

## 服务器环境信息

环境链接：https://confluence.dev.connector.games/pages/viewpage.action?pageId=2097252

### 登陆远程服务器

```sh
ssh -i /Users/shalomhu/Desktop/pem/CON_MONITOR.pem ubuntu@3.35.177.187
ssh -i /Users/shalomhu/Desktop/pem/forbscgeth.cer ubuntu@35.86.61.129
//  SDK 测试环境
ssh -i /Users/shalomhu/Desktop/pem/u8.cer ec2-user@52.77.255.42

go build -o api cmd/api/main.go
go build -o collector cmd/collector/main.g
```

新的环境信息

```sh
// 测试环境服务器
ssh -i /Users/shalomhu/Desktop/pem/dev.pem ec2-user@13.215.69.154

// 怪物工程师的目录
/data/MEBack

// 前台和后台端口
13.215.69.154:8890 后台
13.215.69.154:8891 前台

// 签名机
http://13.215.69.154:8086
    
// mysql
13.251.138.95 

// redis
13.251.138.95
```

FQ4S5QAHV2DYN3RX84GUVQNST4G18W8K55  Etherscan

### 部署

BSC公共节点列表：

recomment

- <https://bsc-dataseed.binance.org/>
- <https://bsc-dataseed1.defibit.io/>
- <https://bsc-dataseed1.ninicoin.io/>

backup

- <https://bsc-dataseed2.defibit.io/>
- <https://bsc-dataseed3.defibit.io/>
- <https://bsc-dataseed4.defibit.io/>
- <https://bsc-dataseed2.ninicoin.io/>
- <https://bsc-dataseed3.ninicoin.io/>
- <https://bsc-dataseed4.ninicoin.io/>
- <https://bsc-dataseed1.binance.org/>
- <https://bsc-dataseed2.binance.org/>
- <https://bsc-dataseed3.binance.org/>
- <https://bsc-dataseed4.binance.org/>

The rate limit of BSC endpoint on Testnet and Mainnet is 10K/5min.

## PeckShield闪电贷:

1. 0x16c87d9c4eb3bc6c4e5fbba789f72e8bbfc81b3403089294a81f31b91088fc2f <https://twitter.com/peckshield/status/1407529373402419200>
2. 0x153eeae811a9acedad4dc76492316d5503a02ad8a324563a50b7118b4f574469 <https://twitter.com/peckshield/status/1407479655142100994>
3. 0xeaaa8f4d33b1035a790f0d7c4eb6e38db7d6d3b580e0bbc9ba39a9d6b80dd250 <https://twitter.com/peckshield/status/1407477776198737922> [ok]
4. 0x0220704a99ddfb982d26e65cc337f26b77dc057930b7aa1d848cc48ec77984a8 <https://twitter.com/peckshield/status/1406839879305101313> [ok]
5. 0x5db64a4b50ba734a57228816807901a893c44c1dc49b6f0f5ee3534c5aecbe03 <https://twitter.com/peckshield/status/1400929644807954433> [ok]
6. 0x50b0c05dd326022cae774623e5db17d8edbc41b4f064a3bcae105f69492ceadc <https://twitter.com/peckshield/status/1398757685714108418> [ok]
7. 0xac8a739c1f668b13d065d56a03c37a686e0aa1c9339e79fcbc5a2d0a6311e333 <https://twitter.com/peckshield/status/1398025307223851009?s=20> [ok]
8. 0xfbe65ad3eed6b28d59bf6043debf1166d3420d214020ef54f12d2e0583a66f13 <https://twitter.com/peckshield/status/1396950958664466434?s=20> [ok]



## 甘霖

1. 翻墙，看看一些国外画家的视频

2. 找到一些艺术分享论坛，高质量的那种，并且有很多大咖

    <https://zhuanlan.zhihu.com/p/24456720>

3. 每周出3-4幅作品，想画啥就画啥，发布到论坛上

4. 去那些高校旅游，看看那里的人文、环境、操场、食堂、展览；如果当地有艺术展览的话，顺便参加一下

## Study

1. xsql <https://github.com/jmoiron/sqlx>
2. nginx
3. grpc

## Nodejs

### 异步编程

1. 通过中间函数减少回调嵌套

    ```js
    var http = require('http');
    
    var fs = require('fs');
    
    var server = http.createServer(function (req, res)
      getTitles(res);
    }).listen(8000, "127.0.0.1");
    
    
    function getTitles(res) {
      fs.readFile('./titles.json', function (err, data) {
        if (err) return hadError(err, res)　　//在这里不再创建一个else分支，而是直接return，因为如果出错的话，也没必要继续执行这个函数了
    
        getTemplate(JSON.parse(data.toString()), res)
      })
    }
    
    function getTemplate(titles, res) {
      fs.readFile('./template.html', function (err, data) {
        if (err) return hadError(err, res)
        formatHtml(titles, data.toString(), res)
      })
    }
    
    function formatHtml(titles, tmpl, res) {
      var html = tmpl.replace('%', titles.join('</li><li>'));
      res.writeHead(200, {'Content-Type': 'text/html'});
      res.end(html);
    }
    
    function hadError(err, res) {
      console.error(err)
      res.end('Server Error')
    }
    ```

2. 使用事件发射器来组织回调

    ```js
    var events = require('events');
    
    var net = require('net');
    
    var channel = new events.EventEmitter();
    
    channel.clients = {};
    
    channel.subscriptions = {};
    
    channel.on('join', function(id, client) {
      this.clients[id] = client;  //添加join事件的监听器，保存用户的client对象，以便程序可以将数据发送给用户；  
    
      this.subscriptions[id] = function(senderId, message) {
        if (id != senderId) {  //忽略发出这一广播数据的用户
          this.clients[id].write(message);
        } 
      }
    
      this.on('broadcast', this.subscriptions[id]);  //添加一个专门针对当前用户的broadcast事件监听器
    });
    
    var server = net.createServer(function (client) {
      var id = client.remoteAddress + ':' + client.remotePort;
      client.on('connect', function() {
        channel.emit('join', id, client);   //当有用户连到服务器上来时发出一个`join`事件，指明用户ID和client对象
      });
    
      client.on('data', function(data) {
        data = data.toString();
        channel.emit('broadcast', id, data);  //当有用户发送数据时，发出一个频道`broadcast`事件，指明用户ID和消息
      });
    });
    
    server.listen(8888);
    ```



## 合约技术信息

[时间锁](https://blog.openzeppelin.com/bypassing-smart-contract-timelocks/)

## Flashbots

```sh
# Identity account
fb01 simulate 0xB54E16EB94bADe99E691be0C5E941aA700497ACD f203e301501837897a65bd5515dc9b9cde88f3861dc71ee11ba0e09fe25ba7de

fb02 simulate 0x4dA1e552D98D827c82a3547feA2e0372D241977d 90a795cc42921becf12052b28630b6ae712875d0815013b545e9013f1d4073e9

fb03 0x842691b5e7FE06b107035be62C3d09c3abC283E1 75b6b70494751283c8e0c8ad54f21a37acf18ee9d6d605e504c5dc8500286e8a
```

## bsc节点搭建

```bash
# 后台解压
nohup tar zxvf geth.tar.gz &
# 查看解压进度
tail -f /home/ubuntu/nohup.out
# 初始化
./build/bin/geth --datadir ../bscNode/ init genesis.json
# 节点启动命令
/1.5T/bsc/build/bin/geth --config /1.5T/bsc/config.toml --http --ws --graphql --syncmode fast --datadir /1.5T/bscNode --diffsync --snapshot=false  --cache 8000 --rpc.allow-unprotected-txs --txlookuplimit 2350000
# 进入控制台
./build/bin/geth attach http://localhost:8545
```

Please visit https://api.binance.org/v1/discovery/peers to get dynamic peer info. You can append the peer info to the StaticNodes in the config.toml 

同步模式 fast：  

当前Geth的默认同步模式称为快速同步。快速同步不是从起源块开始，然后重新处理所有发生过的事务(这可能需要几周的时间)；而是下载块，并且只验证相关的工作证明。下载所有的块是一个简单和快速的过程，将相对较快地重新组装整个链。  

许多人错误地认为，因为他们拥有这些块，所以他们是同步的。不幸的是，情况并非如此，因为没有执行任何事务，所以我们没有任何可用的帐户状态(即。余额、nonces、智能合约代码和数据)。这些需要分别下载，并与最新的块交叉检查。这个阶段叫做 the state trie download，它实际上是与块下载同时运行的，比下载数据块要花更长的时间。

You should see in your Geth console Imported state entries logs scrolling and you must wait for the sync to complete.

## 怪物工程师对接文档

怪物工程师后台：<https://modao.cc/app/bf0119657bbe5a9f3345ed4bf3b17af7dc73dfd2#screen=skyb0y4vwutvfi8>

前端对接文档：<https://shimo.im/docs/JCgPHJcVWYDKTGY8>

怪物工程师游戏方对接文档：<http://52.77.255.42:4568/#ft-2>

Dashboard网页：<https://connexion.games/dashboard/#/account-wrap/1/>

管理后台网页：<http://52.77.255.42:12323/index>

u8sdk后台：https://shimo.im/docs/KPXhtwWh8hJKDDdc/read

Dashboard与GO_SDk交互：https://shimo.im/docs/JCgPHJcVWYDKTGY8

## 合约部署

NFT合约初始化设置步骤：

1. 打开公售开关 openPublicSale
5. 设置公售每个用户最多mint数量 setPubPer
7. 设置盲盒图片URI setBlindBoxURI

### 测试网合约部署

#### 开发环境

合约地址：

```sh
#  treasure deployed at: 
0x8A1c9AeE54063383c851F48aA9119e1D494766Eb
# timelock deployed at: 
0x2044DdF887C6C298c74fF7091baBF54722E1C213
# reveal deployed at: 
0xD0ACc6F6C7059C9f05252693D05Cba45E24fe01c
# equipment deployed at: 
0x8d67808712d6FCA802fE99691742171cbDFCa01e
# binance seller deployed at: 
0x4DA6E89c3f24dCe6Af3c6b3692Ee585a01D12A70
# gameMinter deployed at: 
0x3386aE54961619FF88731b88401D644F9f55EB45
# binance nft 1 deployed to:
0x60CC9c0349c0bee120329905a4549110951F7B50
# binance nft 2 deployed to:
0x138457cbE26F7D8849e035246aeF7275BAf98634
```

#### 测试环境

```sh
#  treasure deployed at: 
0xcF342eBb891301472D18D40a46670d8A43276216
# timelock deployed at: 
0x8fE1D048630D1b066F8ff13468eCF5d24413C2A9
# reveal deployed at: 
0x47e844BE6cdFAE298Ef75DE2411eE22bE4FBa32A
# equipment deployed at: 
0x6eAF67145Cdb8b336BcAC510827A6133D68f8474
# binance seller deployed at: 
0x9516c7D47a4814f5c8b09864EbcABbdE71216583
# gameMinter deployed at: 
0x091AEdD7CF71a903A738c39d88f0C7aE1956BbAB
# binance nft 1 deployed to:
0xe4293e2E48256c7b00ee6af79701Ee2CD26558D7
# binance nft 2 deployed to:
0x4f7406ad274b6f4fA1D6b30f91F0fc4cB5E519Fb
```

#### Verify Etherscan

Verify命令：

```sh
# timelocker
npx hardhat verify 0x8fE1D048630D1b066F8ff13468eCF5d24413C2A9 1 --network rinkeby

# treasure
npx hardhat verify 0xcF342eBb891301472D18D40a46670d8A43276216 --constructor-args scripts/args/GameLootTreasureArguments.js --network rinkeby

# equipment
npx hardhat verify 0x6eAF67145Cdb8b336BcAC510827A6133D68f8474 --constructor-args scripts/args/GameLootEquipmentArguments.js --network rinkeby

# gameMinter
npx hardhat verify 0x3386aE54961619FF88731b88401D644F9f55EB45 --constructor-args scripts/args/GameLootGameMinterArgument.js --network rinkeby

# seller
npx hardhat verify 0x48A77c174e1B6e97136acb8d1a57eBE9E0a914f6 --constructor-args scripts/args/GameLootSellerArguments.js --network rinkeby
```

#### 币安盲盒合约地址 dev环境

```sh
# timelock deployed to:
0xf2254424E25D9A3a860f2d4a81120C484F00c998
# equipment deployed to:
0x416CAc2020aaAa88881eEf4D2582b2BdED74D9dC
# testNFT deployed to:
0x60CC9c0349c0bee120329905a4549110951F7B50
# binanceSeller deployed to:
0xe95E242C9A19c6a8f88fb214608B3f34Da581d7A
```

#### 币安盲盒合约地址 test环境

```sh
# timelock deployed to:
0xC754051E97562959750d1c2BD1b5b3BFd7e9e38c
# equipment deployed to:
0xA02e4744754B414c95466fA58F632A772282672d
# testNFT deployed to:
0xe4293e2E48256c7b00ee6af79701Ee2CD26558D7
# binanceSeller deployed to:
0x04C512F827271Af43AF245A4CB37bc90f28531B2
```

### BSC主网合约部署

#### ERC20

factory：0x11b39Ac1E9d5450B3A1F30234423C031bA0B1f9b
logic：0xaA5dBe6C5cB8698C9a86b61F1Cd1F038269D79f7
Archloot (ALT)：0x1BD55090B8878630E57FAE6eBd11FD61d16DFC9f

#### ERC721

Archloot NFT：0x4b3cB7F82b4d412FA020f20aC2Df4B036FEEf9f8

## 合约监控需求整理

opensea交易监控，巨鲸账号追踪

游戏NFT合约mint功能监控

## 币安NFT文档翻译

### Batch Deposit Procedures

1. 创建一个用于接收存款的币安账户。 还要为此帐户完成 KYC。
2. 将钱包（https://www.binance.com/en/nft/mywallet）连接到您的上述账户，将用于转移铸造的 NFT。 此步骤对于任何后续操作都是必不可少的，请完成后提供 UID 以供检查。
3. 使用经过审核的合约将 NFT 铸造到步骤#2 中提到的绑定钱包中，之后
minting 我们将再次审查合同。 *请不要直接将代币铸造到我们的
币安官方充值钱包地址
4. 将其中一个 NFT 从您的钱包转移到我们的 Binance 官方钱包地址。 为了验证，您应该能够看到存储在您相应的币安账户中的资产。注意：
未完成第 1 步和第 2 步，请勿进行转账，否则您的资产可能会被
丢失。
    - BSC: Oxe0A9e5B59701a776575fDd6257c3F89Ae362629a
    — ETH: Oxc67dbOdf922238979daOfd00d46016e8ae14cecb
5. 完成并成功验证第 4 步后，您就可以使用批量传输，将所有代币存入上述地址的方法。

注意⚠️：在整个充值过程中，请确保您的钱包和币安账户已绑定，请务必
不要在质押过程中解绑。

### Lazy Deposit Procedures

1. 创建一个用于接收存款的币安账户。 还要为此帐户完成 KYC。
2. 将钱包（https://www.binance.com/en/nft/mywallet）连接到您的上述账户，将用于转移铸造的 NFT。 此步骤对于任何后续操作都是必不可少的，请完成后提供 UID 以供检查。
3. 使用经过审核的合约将 NFT 铸造到步骤#2 中提到的绑定钱包中，之后 minting 我们将再次审查合同。 *请不要直接将代币铸造到我们的
币安官方充值钱包地址。
4. 通过`approve all`方法将所有NFT的批准给binance的热钱包地址。
    - BSC: 0xe0A9e5B59701a776575fDd6257c3F89Ae362629a
    - ETH: 0xc67db0df922238979da0fd00d46016e8ae14cecb

注意⚠️：在整个销售过程中，请确保您的钱包和币安账户已绑定，请务必
不要在质押过程中解绑。在我们完成所有交易之前不要将任何 NFT 转移到其他地址。


## 1155 metadata 模板

{
  "image":"ipfs://QmckTTnc1148hnAk43TJhv8mTKZAcUKjFUmCfVKsj3MDMM",
  "name":"Genesis Avatars Whitelist Pass",
  "description":"A whitelist pass that allows the wallet holding it to mint 1 NFT Worlds Genesis Avatar on May 4th for 0.4 Eth. One whitelist pass allows for one Genesis Avatar mint. One whitelist pass is burnt for each Genesis Avatar minted. Minting will be available on May 4th at https://nftworlds.com/avatars",
  "attributes":[
    {"trait_type": "Mint Date", "value": "May 4th"},
    {"trait_type": "Mint Location", "value": "nftworlds.com/avatars"}
  ]
}

## 我的工作内容记录

- 给狗哥编写批量转账脚本
- 在以太坊论坛上创建协议讨论贴
- 研究opensea
